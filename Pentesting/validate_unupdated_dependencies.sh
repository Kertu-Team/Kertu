#!/bin/bash

# Cel repozytorium
REPO_URL="https://github.com/Kertu-Team/Kertu"
REPO_DIR="/tmp/Kertu"

# Funkcja instalacji Retire.js
install_retirejs() {
  echo "Retire.js not found. Installing..."
  if ! command -v npm &> /dev/null; then
    echo "npm not found. Installing npm..."
    apt-get update
    apt-get install -y npm
  fi
  npm install -g retire
  echo "Retire.js has been installed."
}

echo "Starting dependency validation..."

# Pobieranie repozytorium
if [ -d "$REPO_DIR" ]; then
  echo "Repository already exists at $REPO_DIR. Pulling latest changes..."
  git -C $REPO_DIR pull
else
  echo "Cloning repository from $REPO_URL..."
  git clone $REPO_URL $REPO_DIR
fi

# Sprawdzenie, czy Retire.js jest zainstalowane
if ! command -v retire &> /dev/null; then
  install_retirejs
fi

# Wykonywanie testu za pomocÄ… Retire.js
echo "Checking for outdated dependencies using Retire.js..."
retire --path $REPO_DIR
echo "Dependency validation completed."