#!/bin/bash

# Ustawienia
REPO_URL="https://github.com/Kertu-Team/Kertu"
REPO_DIR="/tmp/Kertu"

echo "Starting GitHub Actions security validation..."

# Pobieranie repozytorium
if [ -d "$REPO_DIR" ]; then
  echo "Repository already exists at $REPO_DIR. Pulling latest changes..."
  git -C $REPO_DIR pull
else
  echo "Cloning repository from $REPO_URL..."
  git clone $REPO_URL $REPO_DIR
fi

# Wykrywanie sekretów i niebezpiecznych konfiguracji
echo "Testing for insecure GitHub Actions using Gitleaks..."
RESULT=$(gitleaks detect --source $REPO_DIR)

# Sprawdzenie wyników
if [ -z "$RESULT" ]; then
  echo "No issues found. The repository is secure."
else
  echo "Potential issues found:"
  echo "$RESULT"
fi

echo "GitHub Actions security validation completed."