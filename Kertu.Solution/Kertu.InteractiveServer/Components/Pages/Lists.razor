@page "/lists"
@using Kertu.InteractiveServer.Data.KertuElements
@using Microsoft.EntityFrameworkCore
@using Data

@inject ApplicationDbContext dbContext

<RadzenStack Gap="1rem">
	<!-- Tasks List Section -->
	<RadzenCard Variant="Variant.Outlined">
		<RadzenText TextStyle="TextStyle.H5" TagName="TagName.H4" class="rz-mb-2">Tasks</RadzenText>
		<RadzenDataList AllowVirtualization="true" Style="height:400px;overflow:auto;"
						Data="@activeTasks" TItem="KertuCard" PageSize="5" PagerHorizontalAlign="HorizontalAlign.Left" ShowPagingSummary="true">
			<Template Context="task">
				<RadzenCard Variant="Variant.Outlined" class="rz-p-0" Style="width: 100%; overflow: hidden;">
					<RadzenRow Gap="0">
						<RadzenColumn Size="12" SizeLG="3" class="rz-p-4 product-title">
							<RadzenText TextStyle="TextStyle.H6" TagName="TagName.H5" class="rz-color-on-secondary-lighter">@(task.Name)</RadzenText>
						</RadzenColumn>
						<RadzenColumn Size="12" SizeLG="7" class="rz-p-4">
							<RadzenText TextStyle="TextStyle.H6" TagName="TagName.H5" class="rz-mb-0">Card ID</RadzenText>
							<RadzenText TextStyle="TextStyle.Body2">@(task.Id)</RadzenText>
						</RadzenColumn>
						<RadzenColumn Size="12" SizeLG="2" class="rz-p-4">
							<RadzenButton Text="View Details" Style="width: 100%" />
						</RadzenColumn>
					</RadzenRow>
				</RadzenCard>
			</Template>
		</RadzenDataList>
	</RadzenCard>

	<!-- Completed Tasks List Section -->
	<RadzenCard Variant="Variant.Outlined">
		<RadzenText TextStyle="TextStyle.H5" TagName="TagName.H4" class="rz-mb-2">Completed Tasks</RadzenText>
		<RadzenDataList AllowVirtualization="true" Style="height:400px;overflow:auto;"
						Data="@completedTasks" TItem="KertuCard" PageSize="5" PagerHorizontalAlign="HorizontalAlign.Left" ShowPagingSummary="true">
			<Template Context="task">
				<RadzenCard Variant="Variant.Outlined" class="rz-p-0" Style="width: 100%; overflow: hidden;">
					<RadzenRow Gap="0">
						<RadzenColumn Size="12" SizeLG="3" class="rz-p-4 product-title">
							<RadzenText TextStyle="TextStyle.H6" TagName="TagName.H5" class="rz-color-on-secondary-lighter">@(task.Name)</RadzenText>
						</RadzenColumn>
						<RadzenColumn Size="12" SizeLG="7" class="rz-p-4">
							<RadzenText TextStyle="TextStyle.H6" TagName="TagName.H5" class="rz-mb-0">Card ID</RadzenText>
							<RadzenText TextStyle="TextStyle.Body2">@(task.Id)</RadzenText>
						</RadzenColumn>
						<RadzenColumn Size="12" SizeLG="2" class="rz-p-4">
							<RadzenButton Text="View Details" Style="width: 100%" />
						</RadzenColumn>
					</RadzenRow>
				</RadzenCard>
			</Template>
		</RadzenDataList>
	</RadzenCard>
</RadzenStack>

<style>
	.product-title {
		min-height: 72px;
		background-color: var(--rz-secondary-lighter);
	}
</style>

@code {
	List<KertuCard> activeTasks = new();
	List<KertuCard> completedTasks = new();

	protected override async Task OnInitializedAsync()
	{
		await base.OnInitializedAsync();

		// Fetch and filter tasks based on completion status
		var allTasks = await dbContext.KertuCards.Where(kc => kc.Name != null).ToListAsync();
		activeTasks = allTasks.Where(t => !t.IsCompleted).ToList();
		completedTasks = allTasks.Where(t => t.IsCompleted).ToList();
	}
}
